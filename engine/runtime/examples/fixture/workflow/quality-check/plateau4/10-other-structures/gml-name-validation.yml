id: n8062ae8-f2a9-11f0-8ef7-7c70db10a7f0
name: PLATEAU4.GmlNameValidation
nodes:
- id: o8062ae8-f2a9-11f0-8ef7-7c70db10a7f1
  name: InputRouter
  type: action
  action: InputRouter
  with:
    routingPort: default
- id: p8062ae8-f2a9-11f0-8ef7-7c70db10a7f2
  name: XMLXQueryExtractor
  type: action
  action: XMLXQueryExtractor
  with:
    xqueryExpression: |
      declare namespace gml="http://www.opengis.net/gml";
      declare namespace gen="http://www.opengis.net/citygml/generics/2.0";
      (
        data(//*@gml:id),
        data(//*/gml:name),
        data(//*/gml:name/@codeSpace)
      )
    sourceAttribute: xml_fragment
- id: q8062ae8-f2a9-11f0-8ef7-7c70db10a7f3
  name: XMLFragmenter
  type: action
  action: XMLFragmenter
  with:
    embeddedExpressions: GenericCityObject
    sourceType: xmlFile
    sourceFile: |
      env.get("__value")["_gml_path"]
- id: r8062ae8-f2a9-11f0-8ef7-7c70db10a7f4
  name: AttributeManagerExtractFields
  type: action
  action: AttributeManager
  with:
    operations:
      - attribute: gml_id
        method: create
        value: |
          env.get("__value")["_results{0}"]
      - attribute: gml_name
        method: create
        value: |
          env.get("__value")["_results{1}"]
      - attribute: codeSpace
        method: create
        value: |
          env.get("__value")["_results{2}"]
- id: s8062ae8-f2a9-11f0-8ef7-7c70db10a7f5
  name: TesterGmlNameValidation
  type: action
  action: Tester
  with:
    conditions:
      - attribute: codeSpace
        operator: isMissing
        value: ""
        outputPort: failed
      - attribute: codeSpace
        operator: equals
        value: ""
        outputPort: failed
    defaultOutputPort: passed
- id: t8062ae8-f2a9-11f0-8ef7-7c70db10a7f6
  name: StatisticsCalculatorGmlNameErrors
  type: action
  action: StatisticsCalculator
  with:
    calculations:
      - newAttribute: gml_name_errors
        operation: count
        sourceAttribute: gml_id
    groupBy:
      - file_index
- id: u8062ae8-f2a9-11f0-8ef7-7c70db10a7f7
  name: FeatureMergerGmlName
  type: action
  action: FeatureMerger
  with:
    requestorAttributeValue: |
      env.get("__value").file_index
    supplierAttributeValue: |
      env.get("__value").file_index
- id: v8062ae8-f2a9-11f0-8ef7-7c70db10a7f8
  name: AttributeManagerGmlNameResults
  type: action
  action: AttributeManager
  with:
    operations:
      - attribute: "コード化されていないgml_nameあり"
        method: create
        value: |
          if env.get("__value").gml_name_errors > 0 {
            1
          } else {
            0
          }
- id: w8062ae8-f2a9-11f0-8ef7-7c70db10a7f9
  name: OutputRouter
  type: action
  action: OutputRouter
  with:
    routingPort: default
edges:
- id: x8062ae8-f2a9-11f0-8ef7-7c70db10a7fa
  from: o8062ae8-f2a9-11f0-8ef7-7c70db10a7f1
  to: p8062ae8-f2a9-11f0-8ef7-7c70db10a7f2
  fromPort: default
  toPort: default
- id: y8062ae8-f2a9-11f0-8ef7-7c70db10a7fb
  from: p8062ae8-f2a9-11f0-8ef7-7c70db10a7f2
  to: q8062ae8-f2a9-11f0-8ef7-7c70db10a7f3
  fromPort: query_results
  toPort: default
- id: z8062ae8-f2a9-11f0-8ef7-7c70db10a7fc
  from: q8062ae8-f2a9-11f0-8ef7-7c70db10a7f3
  to: r8062ae8-f2a9-11f0-8ef7-7c70db10a7f4
  fromPort: fragments
  toPort: default
- id: a8062ae8-f2a9-11f0-8ef7-7c70db10a7fd
  from: r8062ae8-f2a9-11f0-8ef7-7c70db10a7f4
  to: s8062ae8-f2a9-11f0-8ef7-7c70db10a7f5
  fromPort: default
  toPort: default
- id: b8062ae8-f2a9-11f0-8ef7-7c70db10a7fe
  from: s8062ae8-f2a9-11f0-8ef7-7c70db10a7f5
  to: t8062ae8-f2a9-11f0-8ef7-7c70db10a7f6
  fromPort: failed
  toPort: default
- id: c8062ae8-f2a9-11f0-8ef7-7c70db10a7ff
  from: t8062ae8-f2a9-11f0-8ef7-7c70db10a7f6
  to: u8062ae8-f2a9-11f0-8ef7-7c70db10a7f7
  fromPort: summary
  toPort: supplier
- id: d8062ae8-f2a9-11f0-8ef7-7c70db10a800
  from: o8062ae8-f2a9-11f0-8ef7-7c70db10a7f1
  to: u8062ae8-f2a9-11f0-8ef7-7c70db10a7f7
  fromPort: default
  toPort: requestor
- id: e8062ae8-f2a9-11f0-8ef7-7c70db10a801
  from: u8062ae8-f2a9-11f0-8ef7-7c70db10a7f7
  to: v8062ae8-f2a9-11f0-8ef7-7c70db10a7f8
  fromPort: merged
  toPort: default
- id: f8062ae8-f2a9-11f0-8ef7-7c70db10a802
  from: v8062ae8-f2a9-11f0-8ef7-7c70db10a7f8
  to: w8062ae8-f2a9-11f0-8ef7-7c70db10a7f9
  fromPort: default
  toPort: default