# GenericCityObject quality check subgraph
# GenericCityObject supports LOD0-3 with various geometry types
# LOD0: Surface (essentially 2D) topology validation
# LOD1/2/3: Surface topology validation
# LOD2/3: Solid boundary validation
id: b2c3d4e5-f6a7-8b9c-0d1e-2f3a4b5c6d7f
name: "GEN.GenericCityObjectValidation"
nodes:
  - id: a1b2c3d4-e5f6-7a8b-9c0d-1e2f3a4b5c6e
    name: InputRouter
    type: action
    action: InputRouter
    with:
      routingPort: default

  # LOD splitter
  - id: b2c3d4e5-f6a7-8b9c-0d1e-2f3a4b5c6d70
    name: LodSplitterWithDM
    type: subGraph
    subGraphId: 7e98d856-1438-4148-bdcb-91747ef2e405

  # ===== Surface Validation for LOD0-3 =====
  # SurfaceValidator3D for LOD0
  - id: c1d2e3f4-a5b6-7c8d-9e0f-1a2b3c4d5e6a
    name: SurfaceValidator3D_LOD0
    type: subGraph
    subGraphId: 8a5b1c9d-2e4f-4a3b-9c5d-1e6f8a2b4c7d

  # SurfaceValidator3D for LOD1
  - id: c2d3e4f5-b6c7-8d9e-0f1a-2b3c4d5e6f7b
    name: SurfaceValidator3D_LOD1
    type: subGraph
    subGraphId: 8a5b1c9d-2e4f-4a3b-9c5d-1e6f8a2b4c7d

  # SurfaceValidator3D for LOD2
  - id: c3d4e5f6-c7d8-9e0f-1a2b-3c4d5e6f7a8c
    name: SurfaceValidator3D_LOD2
    type: subGraph
    subGraphId: 8a5b1c9d-2e4f-4a3b-9c5d-1e6f8a2b4c7d

  # SurfaceValidator3D for LOD3
  - id: c4d5e6f7-d8e9-0f1a-2b3c-4d5e6f7a8b9d
    name: SurfaceValidator3D_LOD3
    type: subGraph
    subGraphId: 8a5b1c9d-2e4f-4a3b-9c5d-1e6f8a2b4c7d

  # ===== AttributeMapper for surface errors =====
  - id: d1e2f3a4-b5c6-7d8e-9f0a-1b2c3d4e5f6a
    name: AttributeMapperSurfaceErrors
    type: action
    action: AttributeMapper
    with:
      mappers:
        - attribute: Folder
          expr: |
            env.get("__value")["udxDirs"] ?? "gen"
        - attribute: Index
          expr: |
            env.get("__value")["fileIndex"] ?? ""
        - attribute: Filename
          expr: |
            env.get("__value")["gmlFilename"] ?? env.get("__value")["name"] ?? ""
        - attribute: FeatureType
          expr: |
            "GenericCityObject"
        - attribute: LOD
          expr: |
            env.get("__value")["lod"] ?? ""
        - attribute: "gml:id"
          expr: |
            env.get("__value")["gmlId"] ?? env.get("__value")["featureId"] ?? ""
        - attribute: エラー数
          expr: |
            1
        - attribute: エラー内容
          expr: |
            let value = env.get("__value");
            if value.validationResult?.details != () {
              return value.validationResult.details[0][0];
            }
            if "issue" in value {
              return value.issue;
            }
            "UnknownError"

  # ===== CSV Writer for surface errors =====
  - id: e1f2a3b4-c5d6-7e8f-9a0b-1c2d3e4f5a6a
    name: CsvWriterSurfaceErrors
    type: action
    action: FeatureWriter
    with:
      format: csv
      output: |
        file::join_path(env.get("workerArtifactPath"), "13_汎用都市オブジェクト_面のエラー.csv")

  # ===== Surface error counter =====
  - id: f1a2b3c4-d5e6-7f8a-9b0c-1d2e3f4a5b6a
    name: SurfaceErrorCounter
    type: action
    action: StatisticsCalculator
    with:
      groupBy:
        - Filename
      calculations:
        - newAttribute: _num_surface_errors
          expr: "1"

  - id: 14a5b5c5-d5e5-f5a5-b5c5-d5e5f5a5b5c6
    name: OutputRouterSurfaceErrors
    type: action
    action: OutputRouter
    with:
      routingPort: errorCountSurfaceErrors

  # ===== Dummy statistics for other error types (not yet implemented) =====
  # Invalid spatial attribute type - dummy statistics
  - id: c3d4e5f6-a7b8-9c0d-1e2f-3a4b5c6d7e80
    name: DummyStatisticsInvalidSpatialAttr
    type: action
    action: StatisticsCalculator
    with:
      groupBy:
        - gmlFilename
      calculations:
        - newAttribute: _num_invalid_spatial_attr
          expr: '0'

  - id: a7b8c9d0-e1f2-3a4b-5c6d-7e8f9a0b1c2f
    name: OutputRouterInvalidSpatialAttr
    type: action
    action: OutputRouter
    with:
      routingPort: errorCountInvalidSpatialAttr

  # ===== Solid Boundary Validation (非水密立体検出) =====
  # SolidBoundaryValidator for LOD1,2,3
  - id: a101a2b3-c4d5-e6f7-a8b9-c0d1e2f3a4b5
    name: SolidBoundaryValidator
    type: action
    action: SolidBoundaryValidator
    with:
      tolerance: |
        0.01

  # Filter for NotClosed errors (NotA2Manifold = non-watertight solid)
  - id: a102b3c4-d5e6-f7a8-b9c0-d1e2f3a4b5c6
    name: FeatureFilterNotClosed
    type: action
    action: FeatureFilter
    with:
      conditions:
        - expr: |
            let issue = env.get("__value").solid_boundary_issues.issue;
            issue == "NotA2Manifold"
          outputPort: notClosed

  # AttributeMapper for NotClosed errors
  - id: a103c4d5-e6f7-a8b9-c0d1-e2f3a4b5c6d7
    name: AttributeMapperNotClosed
    type: action
    action: AttributeMapper
    with:
      mappers:
        - attribute: Folder
          expr: |
            env.get("__value")["udxDirs"] ?? "gen"
        - attribute: Index
          expr: |
            env.get("__value")["fileIndex"] ?? ""
        - attribute: Filename
          expr: |
            env.get("__value")["gmlFilename"] ?? env.get("__value")["name"] ?? ""
        - attribute: FeatureType
          expr: |
            "GenericCityObject"
        - attribute: LOD
          expr: |
            env.get("__value")["lod"] ?? ""
        - attribute: "gml:id"
          expr: |
            env.get("__value")["gmlId"] ?? env.get("__value")["featureId"] ?? ""
        - attribute: エラー数
          expr: |
            1
        - attribute: エラー内容
          expr: |
            "SurfaceNotClosed"

  # CSV Writer for NotClosed errors
  - id: a104d5e6-f7a8-b9c0-d1e2-f3a4b5c6d7e8
    name: FeatureWriterNotClosed
    type: action
    action: FeatureWriter
    with:
      format: csv
      output: |
        file::join_path(env.get("workerArtifactPath"), "13_汎用都市オブジェクト_非水密立体.csv")

  # Error counter for NotClosed
  - id: a105e6f7-a8b9-c0d1-e2f3-a4b5c6d7e8f9
    name: NotClosedErrorCounter
    type: action
    action: StatisticsCalculator
    with:
      groupBy:
        - Filename
      calculations:
        - newAttribute: _num_not_closed_solid
          expr: "1"

  - id: b4c5d6e7-f8a9-0b1c-2d3e-4f5a6b7c8d90
    name: OutputRouterNotClosed
    type: action
    action: OutputRouter
    with:
      routingPort: errorCountNotClosedSolid

  # ===== Solid Issues (立体のエラー) - OtherIssues from SolidBoundaryValidator =====
  # AttributeMapper for OtherIssues (unfiltered = not NotA2Manifold)
  - id: a119d1e2-f3a4-b5c6-d7e8-e9f0a1b2c3d4
    name: AttributeMapperSolidIssues
    type: action
    action: AttributeMapper
    with:
      mappers:
        - attribute: Folder
          expr: |
            env.get("__value")["udxDirs"] ?? "gen"
        - attribute: Index
          expr: |
            env.get("__value")["fileIndex"] ?? ""
        - attribute: Filename
          expr: |
            env.get("__value")["gmlFilename"] ?? env.get("__value")["name"] ?? ""
        - attribute: FeatureType
          expr: |
            "GenericCityObject"
        - attribute: LOD
          expr: |
            env.get("__value")["lod"] ?? ""
        - attribute: "gml:id"
          expr: |
            env.get("__value")["gmlId"] ?? env.get("__value")["featureId"] ?? ""
        - attribute: エラー数
          expr: |
            1
        - attribute: エラー内容
          expr: |
            "InvalidSolidBoundaries"

  # CSV Writer for Solid Issues (立体のエラー)
  - id: a120e2f3-a4b5-c6d7-e8f9-f0a1b2c3d4e5
    name: FeatureWriterSolidIssues
    type: action
    action: FeatureWriter
    with:
      format: csv
      output: |
        file::join_path(env.get("workerArtifactPath"), "13_汎用都市オブジェクト_立体のエラー.csv")

  # Error counter for Solid Issues
  - id: a121f3a4-b5c6-d7e8-f9a0-a1b2c3d4e5f6
    name: SolidIssuesErrorCounter
    type: action
    action: StatisticsCalculator
    with:
      groupBy:
        - Filename
      calculations:
        - newAttribute: _num_solid_errors
          expr: "1"

  # Other solid errors - dummy statistics
  - id: e5f6a7b8-c9d0-1e2f-3a4b-5c6d7e8f9a80
    name: DummyStatisticsOtherSolidErrors
    type: action
    action: StatisticsCalculator
    with:
      groupBy:
        - gmlFilename
      calculations:
        - newAttribute: _num_other_solid_errors
          expr: '0'

  - id: f8a9b0c1-d2e3-4f5a-6b7c-8d9e0f1a2b3d
    name: OutputRouterOtherSolidErrors
    type: action
    action: OutputRouter
    with:
      routingPort: errorCountOtherSolidErrors

  # Boundary surface errors - dummy statistics
  - id: f6a7b8c9-d0e1-2f3a-4b5c-6d7e8f9a0b80
    name: DummyStatisticsBoundarySurfaceErrors
    type: action
    action: StatisticsCalculator
    with:
      groupBy:
        - gmlFilename
      calculations:
        - newAttribute: _num_boundary_surface_errors
          expr: '0'

  - id: 05a5b5c5-d5e5-f5a5-b5c5-d5e5f5a5b5c6
    name: OutputRouterBoundarySurfaceErrors
    type: action
    action: OutputRouter
    with:
      routingPort: errorCountBoundarySurfaceErrors

  # Orientation errors (面の向き不正) - LOD0 only
  - id: d2e3f4a5-b6c7-8d9e-0f1a-2b3c4d5e6f7d
    name: AttributeMapperOrientationErrors
    type: action
    action: AttributeMapper
    with:
      mappers:
        - attribute: Folder
          expr: |
            env.get("__value")["udxDirs"] ?? "gen"
        - attribute: Index
          expr: |
            env.get("__value")["fileIndex"] ?? ""
        - attribute: Filename
          expr: |
            env.get("__value")["gmlFilename"] ?? env.get("__value")["name"] ?? ""
        - attribute: FeatureType
          expr: |
            "GenericCityObject"
        - attribute: LOD
          expr: |
            env.get("__value")["lod"] ?? "0"
        - attribute: "gml:id"
          expr: |
            env.get("__value")["gmlId"] ?? env.get("__value")["featureId"] ?? ""
        - attribute: エラー数
          expr: |
            1
        - attribute: エラー内容
          expr: |
            "IncorrectOrientation"

  - id: e3f4a5b6-c7d8-9e0f-1a2b-3c4d5e6f7a8e
    name: CsvWriterOrientationErrors
    type: action
    action: FeatureWriter
    with:
      format: csv
      output: |
        file::join_path(env.get("workerArtifactPath"), "13_汎用都市オブジェクト_面の向き不正.csv")

  - id: 15a5b5c5-d5e5-f5a5-b5c5-d5e5f5a5b5c7
    name: OrientationErrorCounter
    type: action
    action: StatisticsCalculator
    with:
      groupBy:
        - Filename
      calculations:
        - newAttribute: _num_orientation_errors
          expr: "1"

  - id: 16a5b5c5-d5e5-f5a5-b5c5-d5e5f5a5b5c8
    name: OutputRouterOrientationErrors
    type: action
    action: OutputRouter
    with:
      routingPort: errorCountOrientationErrors

  - id: f4a5b6c7-d8e9-0f1a-2b3c-4d5e6f7a8b9a
    name: OutputRouterFileOutputOrientationErrors
    type: action
    action: OutputRouter
    with:
      routingPort: fileOutput

  # OutputRouter for Solid Errors
  - id: 18a5b5c5-d5e5-f5a5-b5c5-d5e5f5a5b5d0
    name: OutputRouterSolidErrors
    type: action
    action: OutputRouter
    with:
      routingPort: errorCountSolidErrors

  # ===== Uncoded gml:name validation (コード化されていないgml_nameあり) =====
  # GmlNameCodeSpaceValidator - check if gml:name has codeSpace attribute
  - id: 19a5b5c5-d5e5-f5a5-b5c5-d5e5f5a5b5d1
    name: GmlNameCodeSpaceValidator
    type: action
    action: PLATEAU4.GmlNameCodeSpaceValidator
    with:
      cityGmlPath: |
        env.get("__value").gmlPath

  # CSV Writer for gml:name errors
  - id: 21a5b5c5-d5e5-f5a5-b5c5-d5e5f5a5b5d3
    name: CsvWriterGmlNameErrors
    type: action
    action: FeatureWriter
    with:
      format: csv
      output: |
        file::join_path(env.get("workerArtifactPath"), "13_汎用都市オブジェクト_gml_nameエラー.csv")

  # Statistics calculator for uncoded gml:name counts
  - id: 22a5b5c5-d5e5-f5a5-b5c5-d5e5f5a5b5d4
    name: UncodedGmlNameStatsAggregator
    type: action
    action: StatisticsCalculator
    with:
      groupBy:
        - Filename
      calculations:
        - newAttribute: _num_uncoded_gml_name
          expr: "1"

  - id: 20a5b5c5-d5e5-f5a5-b5c5-d5e5f5a5b5d2
    name: OutputRouterUncodedGmlName
    type: action
    action: OutputRouter
    with:
      routingPort: errorCountUncodedGmlName

  # File output router
  - id: a9b0c1d2-e3f4-5a6b-7c8d-9e0f1a2b3c4e
    name: OutputRouterFileOutput
    type: action
    action: OutputRouter
    with:
      routingPort: fileOutput

edges:
  # Input → LodSplitter
  - id: 01a2b3c4-d5e6-f7a8-b9c0-d1e2f3a4b5c7
    from: a1b2c3d4-e5f6-7a8b-9c0d-1e2f3a4b5c6e
    to: b2c3d4e5-f6a7-8b9c-0d1e-2f3a4b5c6d70
    fromPort: default
    toPort: default

  # ===== LOD outputs → SurfaceValidator3D =====
  # LOD0 → SurfaceValidator3D_LOD0
  - id: 02b3c4d5-e6f7-a8b9-c0d1-e2f3a4b5c6d8
    from: b2c3d4e5-f6a7-8b9c-0d1e-2f3a4b5c6d70
    to: c1d2e3f4-a5b6-7c8d-9e0f-1a2b3c4d5e6a
    fromPort: lod0
    toPort: default

  # LOD1 → SurfaceValidator3D_LOD1
  - id: 03c4d5e6-f7a8-b9c0-d1e2-f3a4b5c6d7e9
    from: b2c3d4e5-f6a7-8b9c-0d1e-2f3a4b5c6d70
    to: c2d3e4f5-b6c7-8d9e-0f1a-2b3c4d5e6f7b
    fromPort: lod1
    toPort: default

  # LOD2 → SurfaceValidator3D_LOD2
  - id: 04d5e6f7-a8b9-c0d1-e2f3-a4b5c6d7e8f0
    from: b2c3d4e5-f6a7-8b9c-0d1e-2f3a4b5c6d70
    to: c3d4e5f6-c7d8-9e0f-1a2b-3c4d5e6f7a8c
    fromPort: lod2
    toPort: default

  # LOD3 → SurfaceValidator3D_LOD3
  - id: 05e6f7a8-b9c0-d1e2-f3a4-b5c6d7e8f9a1
    from: b2c3d4e5-f6a7-8b9c-0d1e-2f3a4b5c6d70
    to: c4d5e6f7-d8e9-0f1a-2b3c-4d5e6f7a8b9d
    fromPort: lod3
    toPort: default

  # ===== SurfaceValidator3D invalidSurface outputs → AttributeMapper =====
  # LOD0 invalidSurface → AttributeMapper
  - id: 11a2b3c4-d5e6-f7a8-b9c0-d1e2f3a4b5c8
    from: c1d2e3f4-a5b6-7c8d-9e0f-1a2b3c4d5e6a
    to: d1e2f3a4-b5c6-7d8e-9f0a-1b2c3d4e5f6a
    fromPort: invalidSurface
    toPort: default

  # LOD1 invalidSurface → AttributeMapper
  - id: 12b3c4d5-e6f7-a8b9-c0d1-e2f3a4b5c6d9
    from: c2d3e4f5-b6c7-8d9e-0f1a-2b3c4d5e6f7b
    to: d1e2f3a4-b5c6-7d8e-9f0a-1b2c3d4e5f6a
    fromPort: invalidSurface
    toPort: default

  # LOD2 invalidSurface → AttributeMapper
  - id: 13c4d5e6-f7a8-b9c0-d1e2-f3a4b5c6d7ea
    from: c3d4e5f6-c7d8-9e0f-1a2b-3c4d5e6f7a8c
    to: d1e2f3a4-b5c6-7d8e-9f0a-1b2c3d4e5f6a
    fromPort: invalidSurface
    toPort: default

  # LOD3 invalidSurface → AttributeMapper
  - id: 14d5e6f7-a8b9-c0d1-e2f3-a4b5c6d7e8fb
    from: c4d5e6f7-d8e9-0f1a-2b3c-4d5e6f7a8b9d
    to: d1e2f3a4-b5c6-7d8e-9f0a-1b2c3d4e5f6a
    fromPort: invalidSurface
    toPort: default

  # ===== AttributeMapper → CsvWriter =====
  - id: 21a2b3c4-d5e6-f7a8-b9c0-d1e2f3a4b5c9
    from: d1e2f3a4-b5c6-7d8e-9f0a-1b2c3d4e5f6a
    to: e1f2a3b4-c5d6-7e8f-9a0b-1c2d3e4f5a6a
    fromPort: default
    toPort: default

  # ===== CsvWriter → OutputRouterFileOutput =====
  - id: 22b3c4d5-e6f7-a8b9-c0d1-e2f3a4b5c6da
    from: e1f2a3b4-c5d6-7e8f-9a0b-1c2d3e4f5a6a
    to: a9b0c1d2-e3f4-5a6b-7c8d-9e0f1a2b3c4e
    fromPort: default
    toPort: default

  # ===== AttributeMapper → SurfaceErrorCounter =====
  - id: 23c4d5e6-f7a8-b9c0-d1e2-f3a4b5c6d7eb
    from: d1e2f3a4-b5c6-7d8e-9f0a-1b2c3d4e5f6a
    to: f1a2b3c4-d5e6-7f8a-9b0c-1d2e3f4a5b6a
    fromPort: default
    toPort: default

  # ===== SurfaceErrorCounter → OutputRouterSurfaceErrors =====
  - id: 24d5e6f7-a8b9-c0d1-e2f3-a4b5c6d7e8fc
    from: f1a2b3c4-d5e6-7f8a-9b0c-1d2e3f4a5b6a
    to: 14a5b5c5-d5e5-f5a5-b5c5-d5e5f5a5b5c6
    fromPort: default
    toPort: default

  # ===== LOD outputs → Dummy statistics for other error types =====
  # LOD0 → DummyStatisticsInvalidSpatialAttr (for feature count through validation)
  - id: 31a2b3c4-d5e6-f7a8-b9c0-d1e2f3a4b5d0
    from: c1d2e3f4-a5b6-7c8d-9e0f-1a2b3c4d5e6a
    to: c3d4e5f6-a7b8-9c0d-1e2f-3a4b5c6d7e80
    fromPort: default
    toPort: default

  # LOD1 → DummyStatisticsInvalidSpatialAttr
  - id: 32b3c4d5-e6f7-a8b9-c0d1-e2f3a4b5c6d1
    from: c2d3e4f5-b6c7-8d9e-0f1a-2b3c4d5e6f7b
    to: c3d4e5f6-a7b8-9c0d-1e2f-3a4b5c6d7e80
    fromPort: default
    toPort: default

  # LOD2 → DummyStatisticsInvalidSpatialAttr
  - id: 33c4d5e6-f7a8-b9c0-d1e2-f3a4b5c6d7e2
    from: c3d4e5f6-c7d8-9e0f-1a2b-3c4d5e6f7a8c
    to: c3d4e5f6-a7b8-9c0d-1e2f-3a4b5c6d7e80
    fromPort: default
    toPort: default

  # LOD3 → DummyStatisticsInvalidSpatialAttr
  - id: 34d5e6f7-a8b9-c0d1-e2f3-a4b5c6d7e8f3
    from: c4d5e6f7-d8e9-0f1a-2b3c-4d5e6f7a8b9d
    to: c3d4e5f6-a7b8-9c0d-1e2f-3a4b5c6d7e80
    fromPort: default
    toPort: default

  # ===== Dummy statistics → Output routers =====
  # DummyStatisticsInvalidSpatialAttr → OutputRouter
  - id: 06f7a8b9-c0d1-e2f3-a4b5-c6d7e8f9a0b2
    from: c3d4e5f6-a7b8-9c0d-1e2f-3a4b5c6d7e80
    to: a7b8c9d0-e1f2-3a4b-5c6d-7e8f9a0b1c2f
    fromPort: default
    toPort: default

  # ===== SolidBoundaryValidator edges =====
  # LOD1 → SolidBoundaryValidator
  - id: a110a2b3-c4d5-e6f7-a8b9-c0d1e2f3a4b5
    from: b2c3d4e5-f6a7-8b9c-0d1e-2f3a4b5c6d70
    to: a101a2b3-c4d5-e6f7-a8b9-c0d1e2f3a4b5
    fromPort: lod1
    toPort: default

  # LOD2 → SolidBoundaryValidator
  - id: a111b3c4-d5e6-f7a8-b9c0-d1e2f3a4b5c6
    from: b2c3d4e5-f6a7-8b9c-0d1e-2f3a4b5c6d70
    to: a101a2b3-c4d5-e6f7-a8b9-c0d1e2f3a4b5
    fromPort: lod2
    toPort: default

  # LOD3 → SolidBoundaryValidator
  - id: a112c4d5-e6f7-a8b9-c0d1-e2f3a4b5c6d7
    from: b2c3d4e5-f6a7-8b9c-0d1e-2f3a4b5c6d70
    to: a101a2b3-c4d5-e6f7-a8b9-c0d1e2f3a4b5
    fromPort: lod3
    toPort: default

  # SolidBoundaryValidator (failed) → FeatureFilterNotClosed
  - id: a113d5e6-f7a8-b9c0-d1e2-f3a4b5c6d7e8
    from: a101a2b3-c4d5-e6f7-a8b9-c0d1e2f3a4b5
    to: a102b3c4-d5e6-f7a8-b9c0-d1e2f3a4b5c6
    fromPort: failed
    toPort: default

  # FeatureFilterNotClosed (notClosed) → AttributeMapperNotClosed
  - id: a114e6f7-a8b9-c0d1-e2f3-a4b5c6d7e8f9
    from: a102b3c4-d5e6-f7a8-b9c0-d1e2f3a4b5c6
    to: a103c4d5-e6f7-a8b9-c0d1-e2f3a4b5c6d7
    fromPort: notClosed
    toPort: default

  # AttributeMapperNotClosed → FeatureWriterNotClosed
  - id: a115f7a8-b9c0-d1e2-f3a4-b5c6d7e8f9a0
    from: a103c4d5-e6f7-a8b9-c0d1-e2f3a4b5c6d7
    to: a104d5e6-f7a8-b9c0-d1e2-f3a4b5c6d7e8
    fromPort: default
    toPort: default

  # FeatureWriterNotClosed → OutputRouterFileOutput
  - id: a116a8b9-c0d1-e2f3-a4b5-c6d7e8f9a0b1
    from: a104d5e6-f7a8-b9c0-d1e2-f3a4b5c6d7e8
    to: a9b0c1d2-e3f4-5a6b-7c8d-9e0f1a2b3c4e
    fromPort: default
    toPort: default

  # AttributeMapperNotClosed → NotClosedErrorCounter
  - id: a117b9c0-d1e2-f3a4-b5c6-d7e8f9a0b1c2
    from: a103c4d5-e6f7-a8b9-c0d1-e2f3a4b5c6d7
    to: a105e6f7-a8b9-c0d1-e2f3-a4b5c6d7e8f9
    fromPort: default
    toPort: default

  # NotClosedErrorCounter → OutputRouterNotClosed
  - id: a118c0d1-e2f3-a4b5-c6d7-e8f9a0b1c2d3
    from: a105e6f7-a8b9-c0d1-e2f3-a4b5c6d7e8f9
    to: b4c5d6e7-f8a9-0b1c-2d3e-4f5a6b7c8d90
    fromPort: default
    toPort: default

  # ===== Solid Issues (立体のエラー) edges =====
  # FeatureFilterNotClosed (unfiltered) → AttributeMapperSolidIssues
  - id: a119e2f3-a4b5-c6d7-e8f9-f0a1b2c3d4e5
    from: a102b3c4-d5e6-f7a8-b9c0-d1e2f3a4b5c6
    to: a119d1e2-f3a4-b5c6-d7e8-e9f0a1b2c3d4
    fromPort: unfiltered
    toPort: default

  # AttributeMapperSolidIssues → FeatureWriterSolidIssues
  - id: a120f3a4-b5c6-d7e8-f9a0-a1b2c3d4e5f6
    from: a119d1e2-f3a4-b5c6-d7e8-e9f0a1b2c3d4
    to: a120e2f3-a4b5-c6d7-e8f9-f0a1b2c3d4e5
    fromPort: default
    toPort: default

  # FeatureWriterSolidIssues → OutputRouterFileOutput
  - id: a121a4b5-c6d7-e8f9-a0b1-b2c3d4e5f6a7
    from: a120e2f3-a4b5-c6d7-e8f9-f0a1b2c3d4e5
    to: a9b0c1d2-e3f4-5a6b-7c8d-9e0f1a2b3c4e
    fromPort: default
    toPort: default

  # AttributeMapperSolidIssues → SolidIssuesErrorCounter
  - id: a122b5c6-d7e8-f9a0-b1c2-c3d4e5f6a7b8
    from: a119d1e2-f3a4-b5c6-d7e8-e9f0a1b2c3d4
    to: a121f3a4-b5c6-d7e8-f9a0-a1b2c3d4e5f6
    fromPort: default
    toPort: default

  # SolidIssuesErrorCounter → OutputRouterSolidErrors
  - id: a123c6d7-e8f9-a0b1-c2d3-d4e5f6a7b8c9
    from: a121f3a4-b5c6-d7e8-f9a0-a1b2c3d4e5f6
    to: 18a5b5c5-d5e5-f5a5-b5c5-d5e5f5a5b5d0
    fromPort: default
    toPort: default

  # InputRouter → GmlNameCodeSpaceValidator
  - id: a124d7e8-f9a0-b1c2-d3e4-e5f6a7b8c9d0
    from: a1b2c3d4-e5f6-7a8b-9c0d-1e2f3a4b5c6e
    to: 19a5b5c5-d5e5-f5a5-b5c5-d5e5f5a5b5d1
    fromPort: default
    toPort: default

  # DummyStatisticsOtherSolidErrors (maintain chain for other error types)
  - id: 09c0d1e2-f3a4-b5c6-d7e8-f9a0b1c2d3e5
    from: c3d4e5f6-a7b8-9c0d-1e2f-3a4b5c6d7e80
    to: e5f6a7b8-c9d0-1e2f-3a4b-5c6d7e8f9a80
    fromPort: default
    toPort: default

  - id: 10d1e2f3-a4b5-c6d7-e8f9-a0b1c2d3e4f6
    from: e5f6a7b8-c9d0-1e2f-3a4b-5c6d7e8f9a80
    to: f8a9b0c1-d2e3-4f5a-6b7c-8d9e0f1a2b3d
    fromPort: default
    toPort: default

  # DummyStatisticsBoundarySurfaceErrors → OutputRouter
  - id: 11e2f3a4-b5c6-d7e8-f9a0-b1c2d3e4f5a7
    from: e5f6a7b8-c9d0-1e2f-3a4b-5c6d7e8f9a80
    to: f6a7b8c9-d0e1-2f3a-4b5c-6d7e8f9a0b80
    fromPort: default
    toPort: default

  - id: 12f3a4b5-c6d7-e8f9-a0b1-c2d3e4f5a6b8
    from: f6a7b8c9-d0e1-2f3a-4b5c-6d7e8f9a0b80
    to: 05a5b5c5-d5e5-f5a5-b5c5-d5e5f5a5b5c6
    fromPort: default
    toPort: default

  # ===== Orientation errors (面の向き不正) - LOD0 only =====
  # SurfaceValidator3D_LOD0 inCorrectOrientation → AttributeMapperOrientationErrors
  - id: 25a2b3c4-d5e6-f7a8-b9c0-d1e2f3a4b5c0
    from: c1d2e3f4-a5b6-7c8d-9e0f-1a2b3c4d5e6a
    to: d2e3f4a5-b6c7-8d9e-0f1a-2b3c4d5e6f7d
    fromPort: inCorrectOrientation
    toPort: default

  # AttributeMapperOrientationErrors → CsvWriterOrientationErrors
  - id: 26b3c4d5-e6f7-a8b9-c0d1-e2f3a4b5c6d1
    from: d2e3f4a5-b6c7-8d9e-0f1a-2b3c4d5e6f7d
    to: e3f4a5b6-c7d8-9e0f-1a2b-3c4d5e6f7a8e
    fromPort: default
    toPort: default

  # CsvWriterOrientationErrors → OutputRouterFileOutputOrientationErrors
  - id: 27c4d5e6-f7a8-b9c0-d1e2-f3a4b5c6d7e2
    from: e3f4a5b6-c7d8-9e0f-1a2b-3c4d5e6f7a8e
    to: f4a5b6c7-d8e9-0f1a-2b3c-4d5e6f7a8b9a
    fromPort: default
    toPort: default

  # AttributeMapperOrientationErrors → OrientationErrorCounter
  - id: 28d5e6f7-a8b9-c0d1-e2f3-a4b5c6d7e8f3
    from: d2e3f4a5-b6c7-8d9e-0f1a-2b3c4d5e6f7d
    to: 15a5b5c5-d5e5-f5a5-b5c5-d5e5f5a5b5c7
    fromPort: default
    toPort: default

  # OrientationErrorCounter → OutputRouterOrientationErrors
  - id: 14f5a6b7-c8d9-e0f1-a2b3-c4d5e6f7a8c0
    from: 15a5b5c5-d5e5-f5a5-b5c5-d5e5f5a5b5c7
    to: 16a5b5c5-d5e5-f5a5-b5c5-d5e5f5a5b5c8
    fromPort: default
    toPort: default

  # GmlNameCodeSpaceValidator (gmlNameErrors) → CsvWriterGmlNameErrors
  - id: 18f9a0b1-c2d3-e4f5-a6b7-c8d9e0f1a204
    from: 19a5b5c5-d5e5-f5a5-b5c5-d5e5f5a5b5d1
    to: 21a5b5c5-d5e5-f5a5-b5c5-d5e5f5a5b5d3
    fromPort: gmlNameErrors
    toPort: default

  # CsvWriterGmlNameErrors → OutputRouterFileOutput
  - id: 23a5b5c5-d5e5-f5a5-b5c5-d5e5f5a5b5d5
    from: 21a5b5c5-d5e5-f5a5-b5c5-d5e5f5a5b5d3
    to: a9b0c1d2-e3f4-5a6b-7c8d-9e0f1a2b3c4e
    fromPort: default
    toPort: default

  # GmlNameCodeSpaceValidator (stats) → OutputRouterUncodedGmlName
  # Skip the StatisticsCalculator since the validator already outputs aggregated error counts per file
  - id: 24a5b5c5-d5e5-f5a5-b5c5-d5e5f5a5b5d6
    from: 19a5b5c5-d5e5-f5a5-b5c5-d5e5f5a5b5d1
    to: 20a5b5c5-d5e5-f5a5-b5c5-d5e5f5a5b5d2
    fromPort: stats
    toPort: default

ports:
  outputs:
    - id: errorCountInvalidSpatialAttr
      nodeId: a7b8c9d0-e1f2-3a4b-5c6d-7e8f9a0b1c2f
      port: default
    - id: errorCountNotClosedSolid
      nodeId: b4c5d6e7-f8a9-0b1c-2d3e-4f5a6b7c8d90
      port: default
    - id: errorCountOtherSolidErrors
      nodeId: f8a9b0c1-d2e3-4f5a-6b7c-8d9e0f1a2b3d
      port: default
    - id: errorCountBoundarySurfaceErrors
      nodeId: 05a5b5c5-d5e5-f5a5-b5c5-d5e5f5a5b5c6
      port: default
    - id: errorCountSurfaceErrors
      nodeId: 14a5b5c5-d5e5-f5a5-b5c5-d5e5f5a5b5c6
      port: default
    - id: errorCountOrientationErrors
      nodeId: 16a5b5c5-d5e5-f5a5-b5c5-d5e5f5a5b5c8
      port: default
    - id: errorCountSolidErrors
      nodeId: 18a5b5c5-d5e5-f5a5-b5c5-d5e5f5a5b5d0
      port: default
    - id: errorCountUncodedGmlName
      nodeId: 20a5b5c5-d5e5-f5a5-b5c5-d5e5f5a5b5d2
      port: default
    - id: fileOutput
      nodeId: a9b0c1d2-e3f4-5a6b-7c8d-9e0f1a2b3c4e
      port: default
