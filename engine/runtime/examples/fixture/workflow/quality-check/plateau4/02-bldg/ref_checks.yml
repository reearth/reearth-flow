id: 34e55bec-9185-4a66-9c41-3dbddc1e64fa
name: ReferenceChecker
nodes:
  - id: ab309f69-4758-491b-831c-75ea5c0f05fe
    name: InputRouter
    type: action
    action: InputRouter
    with:
      routingPort: default

  - id: 911ebdb1-a05e-48f4-a208-c0653f1f1731
    name: UnmatchedXlinkDetector
    type: action
    action: PLATEAU4.UnmatchedXlinkDetector
    with: 
      attribute: cityGmlPath

  - id: 691a328a-f39b-403e-b62f-7525771b6f14
    name: L-bldg-Summary
    type: action
    action: NoopSink

  - id: 88c90fea-04d6-4e54-8ab1-4dc6386f6699
    name: AttributeManager
    type: action
    action: AttributeManager
    with: 
      operations:
        - attribute: Attribute
          method: create
          value: |
            "参照元 xlink:href"
        - attribute: unmatchedXmlFromTag
          method: rename
          value: relatedXmlTag
        - attribute: unmatchedXlinkFromId
          method: rename
          value: unmatchedId

  - id: 2d024ca7-cb00-47bb-aa50-12a395a6c8b8
    name: AttributeManager
    type: action
    action: AttributeManager
    with:
      operations:
        - attribute: Attribute
          method: create
          value: |
            "参照元 gml:id"
        - attribute: unmatchedXmlFromTag
          method: rename
          value: relatedXmlTag
        - attribute: unmatchedXlinkFromId
          method: rename
          value: unmatchedId

  - id: 7c7dd820-2c7e-4e79-ab3f-1566fc4bd2ca
    name: AttributeMapperL-bldg-06
    type: action
    action: AttributeMapper
    with:
      mappers:
        - attribute: Index
          expr: |
            env.get("__value").fileIndex
        - attribute: Filename
          expr: |
            file::extract_filename(env.get("__value").cityGmlPath)
        - attribute: "Building gml:id"
          expr: |
            env.get("__value").gmlId
        - attribute: "Related XML Tag"
          expr: |
            collection::join_array((env.get("__value").relatedXMLTags ?? []), ",")
        - attribute: Attribute
          expr: |
            env.get("__value").Attribute
        - attribute: UnmatchedXlinkIds
          expr: |
            collection::join_array((env.get("__value").unmatchedXlinkIds ?? []), ",")

  - id: adba8857-9de2-43bd-8cde-b83bc08a58f6
    name: FileWriterTsvL-bldg-06
    type: action
    action: FileWriter
    with:
      format: tsv
      output: |
        file::join_path(env.get("outputPath"), "02_bldg_l_bldg_06エラー.tsv")
  
edges:
  - id: 93431d4e-fcd2-4308-af3c-9da9441ac911
    from: ab309f69-4758-491b-831c-75ea5c0f05fe
    to: 911ebdb1-a05e-48f4-a208-c0653f1f1731
    fromPort: default
    toPort: default

  - id: 6941c617-dc23-4aa9-b794-b7d409212ccb
    from: 911ebdb1-a05e-48f4-a208-c0653f1f1731
    to: 691a328a-f39b-403e-b62f-7525771b6f14
    fromPort: summary
    toPort: default

  - id: abcb0569-faf7-4317-80d8-fb80a0e5b0d7
    from: 911ebdb1-a05e-48f4-a208-c0653f1f1731
    to: 88c90fea-04d6-4e54-8ab1-4dc6386f6699
    fromPort: unmatchedXlinkFromTag
    toPort: default

  - id: 9830a9fb-73ed-42c2-b2eb-c2315560ae49
    from: 911ebdb1-a05e-48f4-a208-c0653f1f1731
    to: 2d024ca7-cb00-47bb-aa50-12a395a6c8b8
    fromPort: unmatchedXlinkFromId
    toPort: default

  - id: 6e42817f-c316-40d0-b972-17ad2409a350
    from: 88c90fea-04d6-4e54-8ab1-4dc6386f6699
    to: 7c7dd820-2c7e-4e79-ab3f-1566fc4bd2ca
    fromPort: default
    toPort: default

  - id: 59fcfbd3-9e08-4117-bd5d-43854c6af81f
    from: 2d024ca7-cb00-47bb-aa50-12a395a6c8b8
    to: 7c7dd820-2c7e-4e79-ab3f-1566fc4bd2ca
    fromPort: default
    toPort: default

  - id: f398a1bc-8dc3-4b14-a971-3e765afea9ef
    from: 7c7dd820-2c7e-4e79-ab3f-1566fc4bd2ca
    to: adba8857-9de2-43bd-8cde-b83bc08a58f6
    fromPort: default
    toPort: default
  
