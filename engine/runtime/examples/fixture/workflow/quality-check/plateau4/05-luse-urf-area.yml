id: efb10562-9fec-4d8b-8348-1714751f03cf
name: PLATEAU4-quality-check-03-tran-surface-orientation
entryGraphId: 5ebbb775-f99a-45b3-9aa2-3a0c7e909d90
with:
  cityGmlPath: null
  schemas: null
  codelists: null
  outputPath: null
graphs:
- id: 7e98d856-1438-4148-bdcb-91747ef2e405
  name: PLATEAU3.LodSplitterWithDM
  nodes:
  - id: 5848465e-828f-4646-874e-e2f182b73714
    name: InputRouter
    type: action
    action: InputRouter
    with:
      routingPort: default
  - id: 278ab965-ce22-473d-98c6-c7b381c38679
    name: GeometryFilter
    type: action
    action: GeometryFilter
    with:
      filterType: none
  - id: 1787b15c-19b5-4386-a0ff-f0e58f477d07
    name: FeatureFilterByExceptSplit
    type: action
    action: FeatureFilter
    with:
      conditions:
      - expr: |
          env.get("exceptSplit") ?? false
        outputPort: exceptSplit
  - id: 8fe1a102-e3f3-40dd-b235-66e9c148830f
    name: GeometrySplitter
    type: action
    action: GeometrySplitter
  - id: 7c843a02-3b1f-40c1-8214-562e72bfb9a6
    name: FeatureFilterByLod
    type: action
    action: FeatureFilter
    with:
      conditions:
      - expr: |
          env.get("__value").lod == "0"
        outputPort: lod0
      - expr: |
          env.get("__value").lod == "1"
        outputPort: lod1
      - expr: |
          env.get("__value").lod == "2"
        outputPort: lod2
      - expr: |
          env.get("__value").lod == "3"
        outputPort: lod3
      - expr: |
          env.get("__value").lod == "4"
        outputPort: lod4
  - id: dab9d3b6-594e-40cc-9f6b-c605005e3320
    name: Lod0Router
    type: action
    action: OutputRouter
    with:
      routingPort: lod0
  - id: dab9d3b6-594e-40cc-9f6b-c605005e3321
    name: Lod1Router
    type: action
    action: OutputRouter
    with:
      routingPort: lod1
  - id: dab9d3b6-594e-40cc-9f6b-c605005e3322
    name: Lod2Router
    type: action
    action: OutputRouter
    with:
      routingPort: lod2
  - id: dab9d3b6-594e-40cc-9f6b-c605005e3323
    name: Lod3Router
    type: action
    action: OutputRouter
    with:
      routingPort: lod3
  - id: dab9d3b6-594e-40cc-9f6b-c605005e3324
    name: Lod4Router
    type: action
    action: OutputRouter
    with:
      routingPort: lod4
  edges:
  - id: fcc0d596-9169-4289-9f35-07c8cbec6f10
    from: 5848465e-828f-4646-874e-e2f182b73714
    to: 278ab965-ce22-473d-98c6-c7b381c38679
    fromPort: default
    toPort: default
  - id: 1386a662-cf02-4475-a5d2-3668a50a56b7
    from: 278ab965-ce22-473d-98c6-c7b381c38679
    to: 1787b15c-19b5-4386-a0ff-f0e58f477d07
    fromPort: unfiltered
    toPort: default
  - id: ef2f1484-6173-4f34-85bc-58bc45e31bff
    from: 1787b15c-19b5-4386-a0ff-f0e58f477d07
    to: 8fe1a102-e3f3-40dd-b235-66e9c148830f
    fromPort: unfiltered
    toPort: default
  - id: 111cc70e-e1ad-44f4-b4c8-82f7b1cf1309
    from: 8fe1a102-e3f3-40dd-b235-66e9c148830f
    to: 7c843a02-3b1f-40c1-8214-562e72bfb9a6
    fromPort: default
    toPort: default
  - id: 5857909b-7fc0-4d3e-adfa-65a5669a6646
    from: 1787b15c-19b5-4386-a0ff-f0e58f477d07
    to: 7c843a02-3b1f-40c1-8214-562e72bfb9a6
    fromPort: exceptSplit
    toPort: default
  - id: 1a802e2e-c876-42e3-b3ae-639af1bc7780
    from: 7c843a02-3b1f-40c1-8214-562e72bfb9a6
    to: dab9d3b6-594e-40cc-9f6b-c605005e3320
    fromPort: lod0
    toPort: default
  - id: 1a802e2e-c876-42e3-b3ae-639af1bc7781
    from: 7c843a02-3b1f-40c1-8214-562e72bfb9a6
    to: dab9d3b6-594e-40cc-9f6b-c605005e3321
    fromPort: lod1
    toPort: default
  - id: 1a802e2e-c876-42e3-b3ae-639af1bc7782
    from: 7c843a02-3b1f-40c1-8214-562e72bfb9a6
    to: dab9d3b6-594e-40cc-9f6b-c605005e3322
    fromPort: lod2
    toPort: default
  - id: 1a802e2e-c876-42e3-b3ae-639af1bc7783
    from: 7c843a02-3b1f-40c1-8214-562e72bfb9a6
    to: dab9d3b6-594e-40cc-9f6b-c605005e3323
    fromPort: lod3
    toPort: default
  - id: 1a802e2e-c876-42e3-b3ae-639af1bc7784
    from: 7c843a02-3b1f-40c1-8214-562e72bfb9a6
    to: dab9d3b6-594e-40cc-9f6b-c605005e3324
    fromPort: lod4
    toPort: default
- id: 8a5b1c9d-2e4f-4a3b-9c5d-1e6f8a2b4c7d
  name: PLATEAU3.SurfaceValidator3D
  nodes:
  - id: 2f8a4b1c-5e9d-4c2a-8b6e-3f7a9b2c5d8e
    name: InputRouter
    type: action
    action: InputRouter
    with:
      routingPort: default
  - id: 4c7a2b5e-8f1d-4a6c-9e2b-7a4c8e1b3f6d
    name: Noop
    type: action
    action: NoopProcessor
  - id: 6e3b8a1c-f4d7-4b9e-a2c5-8f1b4e6a9c3d
    name: SurfaceRouter
    type: action
    action: OutputRouter
    with:
      routingPort: default
  - id: 1a9c4e7b-2f5d-4e8a-b3c6-9f2a5e8b1c4d
    name: GeometryPartExtractor
    type: action
    action: GeometryPartExtractor
  - id: 3d6f9a2c-5b8e-4a1d-c7f4-2e5a8c3b6f9d
    name: TwoDimensionForcer
    type: action
    action: TwoDimensionForcer
  - id: 5c2a7f4b-8e1d-4f9c-a6e3-4b7f2a5c8e1d
    name: OrientationExtractor
    type: action
    action: OrientationExtractor
    with:
      outputAttribute: outerOrientation
  - id: 7f4a1c6e-b9d2-4c5a-e8f1-6a3c7f4b9e2d
    name: FeatureFilterByOrientation
    type: action
    action: FeatureFilter
    with:
      conditions:
      - expr: |
          env.get("__value").outerOrientation != "counter_clockwise"
        outputPort: inCorrectOrientation
  - id: 9e2b5f8a-1c4d-4a7e-f2b5-8a1e4b7c2f5d
    name: GeometryReplacer
    type: action
    action: GeometryReplacer
    with:
      sourceAttribute: dumpGeometry
  - id: 2a5c8f1b-4e7d-4b2c-a9f6-1c4e7a2b5f8d
    name: InCorrectOrientationRouter
    type: action
    action: OutputRouter
    with:
      routingPort: inCorrectOrientation
  - id: 4f8b3e6a-7d1c-4e5a-c2f9-3a6f9b4e7c1d
    name: GeometryValidator
    type: action
    action: GeometryValidator
    with:
      validationTypes:
      - duplicatePoints
      - corruptGeometry
  - id: 6a1d4f7c-9e2b-4c8a-f5e1-7c2a6f9d4e1b
    name: PlanarityFilter
    type: action
    action: PlanarityFilter
  - id: 8c5f2a9d-1b4e-4f7c-a3d8-5e2c8f1b4a7d
    name: FeatureCounter
    type: action
    action: FeatureCounter
    with:
      countStart: 0
      outputAttribute: surfaceId
  - id: 1e7a4c9b-3f6d-4a2e-c8b5-9d2a5e8c1b4f
    name: HoleCounter
    type: action
    action: HoleCounter
    with:
      outputAttribute: holeCount
  - id: 3b9f6a2d-5c8e-4d1a-f7c4-2e5b8a3f6d9c
    name: FeatureFilterByHole
    type: action
    action: FeatureFilter
    with:
      conditions:
      - expr: |
          true
        outputPort: default
      - expr: |
          env.get("__value").holeCount > 0
        outputPort: hole
  - id: 5d2c7f4a-8b1e-4c6d-a9f2-4a7d2c5f8b1e
    name: GeometryValidatorSelfIntersection
    type: action
    action: GeometryValidator
    with:
      validationTypes:
      - duplicateConsecutivePoints
      - selfIntersection
  - id: 7f5a8c3b-1d4e-4a9f-c2b7-6e3a7f5c8b1d
    name: GeometryCoercerRingNotClosed
    type: action
    action: GeometryCoercer
    with:
      coercerType: lineString
  - id: 9c1e4a7b-6f2d-4e5c-a8b1-3f6c9e1a4b7d
    name: ClosedCurveFilter
    type: action
    action: ClosedCurveFilter
  - id: 2d8a5f3c-4b7e-4c1d-f9a6-8c2d5a8f3b6e
    name: HoleExtractor
    type: action
    action: HoleExtractor
  - id: 4a6c9f2d-7e3b-4d8a-c5f2-1a4c7e9f2d5b
    name: OrientationExtractorOuterShell
    type: action
    action: OrientationExtractor
    with:
      outputAttribute: outerOrientation
  - id: 6f3b1a8e-9c4d-4a7f-e2c9-3b6f1a8e4c7d
    name: ElevationExtractorHole
    type: action
    action: ElevationExtractor
    with:
      outputAttribute: elevation
  - id: 8e7c4a1f-2d5b-4f8e-a6c3-7f4e1c8a5b2d
    name: GeometryCoercerOutershell
    type: action
    action: GeometryCoercer
    with:
      coercerType: lineString
  - id: 1c4f7a2e-5b8d-4a3c-f9e6-4c1f8a7e2b5d
    name: GeometryCoercerHole
    type: action
    action: GeometryCoercer
    with:
      coercerType: lineString
  - id: 3f5a8c1d-7e4b-4c9f-a2e7-6f3a8c1d4e7b
    name: FeatureCounterHole
    type: action
    action: FeatureCounter
    with:
      countStart: 1
      groupBy:
      - surfaceId
      outputAttribute: holeId
  - id: 5b8d1f4a-9c6e-4f2b-c8d5-1f4b8d5a9c2e
    name: FeatureMergerIntersectionbetweenInteriorAndExterior
    type: action
    action: FeatureMerger
    with:
      requestorAttribute:
      - surfaceId
      supplierAttribute:
      - surfaceId
      completeGrouped: true
  - id: 7d4e9a2c-1f5b-4d8a-e7c4-9a2d7e4c1f5b
    name: LineOnLineOverlayer
    type: action
    action: LineOnLineOverlayer
    with:
      groupBy:
      - surfaceId
      - holeId
      tolerance: 0.001
      outputAttribute: overlap
  - id: 9a6c3f8b-4e1d-4a7c-f5b9-3f8a6c9b4e1d
    name: Bufferer
    type: action
    action: Bufferer
    with:
      bufferType: area2d
      distance: 0.005
      interpolationAngle: 22.5
  - id: 2c7f4a9e-8b1d-4f6c-a3e8-7f2c4a9e1b8d
    name: AreaOnAreaOverlayerInteriorAndInterior
    type: action
    action: AreaOnAreaOverlayer
    with:
      groupBy:
      - surfaceId
      accumulationMode: useAttributesFromOneFeature
      outputAttribute: overlap
  - id: 4e1b7c5a-6f9d-4c2e-b8a5-1c4e7b5a6f9d
    name: FeatureFilterByAreaOnAreaOverlap
    type: action
    action: FeatureFilter
    with:
      conditions:
      - expr: |
          env.get("__value").overlap > 1
        outputPort: intersectionInterior
  - id: 5a3b7e9c-2f4d-4a6e-b8c1-3e7a5b9c2f4d
    name: AttributeManagerIntersectionInterior
    type: action
    action: AttributeManager
    with:
      operations:
      - attribute: issue
        method: create
        value: |
          "IntersectionBetweenInteriorAndInterior"
  - id: 6b5d8a3f-1c4e-4b7d-a9c2-5d6b8a3f1c4e
    name: OrientationExtractorIncorrectInterior
    type: action
    action: OrientationExtractor
    with:
      outputAttribute: innerOrientation
  - id: 8f2a5c7d-3e6b-4a9f-c1d4-2a8f5c7d3e6b
    name: FeatureMergerIncorrectInterior
    type: action
    action: FeatureMerger
    with:
      requestorAttribute:
      - surfaceId
      supplierAttribute:
      - surfaceId
      completeGrouped: true
  - id: 1a4d7c2f-9e5b-4d8a-f6c3-4d1a7c2f9e5b
    name: FeatureFilterByIncorrectInteriorOrientation
    type: action
    action: FeatureFilter
    with:
      conditions:
      - expr: |
          env.get("__value").innerOrientation == env.get("__value").outerOrientation
        outputPort: incorrectInterior
  - id: 4b8e2a7d-3f6c-4a1e-b9d5-7a4b8e2d3f6c
    name: AttributeManagerIncorrectInteriorOrientation
    type: action
    action: AttributeManager
    with:
      operations:
      - attribute: issue
        method: create
        value: |
          "IncorrectInteriorOrientation"
  - id: 3c6f9a1e-8d4b-4f3c-a7e2-6f3c9a1e8d4b
    name: InvalidSurfaceRouter
    type: action
    action: OutputRouter
    with:
      routingPort: invalidSurface
  edges:
  - id: 5e8b2a7f-1c4d-4e9b-a6f3-8b5e2a7f1c4d
    from: 2f8a4b1c-5e9d-4c2a-8b6e-3f7a9b2c5d8e
    to: 4c7a2b5e-8f1d-4a6c-9e2b-7a4c8e1b3f6d
    fromPort: default
    toPort: default
  - id: 7f3a6c9e-4d1b-4c7f-e2a5-3f7a6c9e4d1b
    from: 4c7a2b5e-8f1d-4a6c-9e2b-7a4c8e1b3f6d
    to: 6e3b8a1c-f4d7-4b9e-a2c5-8f1b4e6a9c3d
    fromPort: default
    toPort: default
  - id: 9d6a3f2c-8e5b-4a1d-c7f4-6a9d3f2c8e5b
    from: 4c7a2b5e-8f1d-4a6c-9e2b-7a4c8e1b3f6d
    to: 1a9c4e7b-2f5d-4e8a-b3c6-9f2a5e8b1c4d
    fromPort: default
    toPort: default
  - id: 2c5f8a1d-6e9b-4c2f-a7e4-5c2f8a1d6e9b
    from: 1a9c4e7b-2f5d-4e8a-b3c6-9f2a5e8b1c4d
    to: 3d6f9a2c-5b8e-4a1d-c7f4-2e5a8c3b6f9d
    fromPort: extracted
    toPort: default
  - id: 4a7e1c5b-9f2d-4a8e-c6f3-7e4a1c5b9f2d
    from: 3d6f9a2c-5b8e-4a1d-c7f4-2e5a8c3b6f9d
    to: 5c2a7f4b-8e1d-4f9c-a6e3-4b7f2a5c8e1d
    fromPort: default
    toPort: default
  - id: 6f9c4a2e-1d5b-4f7c-e8a1-9c6f4a2e1d5b
    from: 5c2a7f4b-8e1d-4f9c-a6e3-4b7f2a5c8e1d
    to: 7f4a1c6e-b9d2-4c5a-e8f1-6a3c7f4b9e2d
    fromPort: default
    toPort: default
  - id: 8b1e6a3f-4c7d-4b8e-a2f5-1e8b6a3f4c7d
    from: 7f4a1c6e-b9d2-4c5a-e8f1-6a3c7f4b9e2d
    to: 9e2b5f8a-1c4d-4a7e-f2b5-8a1e4b7c2f5d
    fromPort: inCorrectOrientation
    toPort: default
  - id: 1d4a7c2e-8f5b-4d1a-c9f6-4a1d7c2e8f5b
    from: 9e2b5f8a-1c4d-4a7e-f2b5-8a1e4b7c2f5d
    to: 2a5c8f1b-4e7d-4b2c-a9f6-1c4e7a2b5f8d
    fromPort: default
    toPort: default
  - id: 3f6c9a2d-7e4b-4f3c-a8e1-6c3f9a2d7e4b
    from: 1a9c4e7b-2f5d-4e8a-b3c6-9f2a5e8b1c4d
    to: 4f8b3e6a-7d1c-4e5a-c2f9-3a6f9b4e7c1d
    fromPort: extracted
    toPort: default
  - id: 5c8a1f4d-9e2b-4c5a-f7d2-8c5a1f4d9e2b
    from: 4f8b3e6a-7d1c-4e5a-c2f9-3a6f9b4e7c1d
    to: 6a1d4f7c-9e2b-4c8a-f5e1-7c2a6f9d4e1b
    fromPort: success
    toPort: default
  - id: 7e4b9f2a-1c6d-4e7b-a3f8-4b7e9f2a1c6d
    from: 6a1d4f7c-9e2b-4c8a-f5e1-7c2a6f9d4e1b
    to: 3c6f9a1e-8d4b-4f3c-a7e2-6f3c9a1e8d4b
    fromPort: notplanarity
    toPort: default
  - id: 9a2f5c8d-6e1b-4a9f-c4d7-2a9f5c8d6e1b
    from: 6a1d4f7c-9e2b-4c8a-f5e1-7c2a6f9d4e1b
    to: 8c5f2a9d-1b4e-4f7c-a3d8-5e2c8f1b4a7d
    fromPort: planarity
    toPort: default
  - id: 2d7a4c1f-5e8b-4d2a-f6c9-7a2d4c1f5e8b
    from: 8c5f2a9d-1b4e-4f7c-a3d8-5e2c8f1b4a7d
    to: 1e7a4c9b-3f6d-4a2e-c8b5-9d2a5e8c1b4f
    fromPort: default
    toPort: default
  - id: 4b6d9a3c-8f1e-4b6d-a2c7-6b4d9a3c8f1e
    from: 1e7a4c9b-3f6d-4a2e-c8b5-9d2a5e8c1b4f
    to: 3b9f6a2d-5c8e-4d1a-f7c4-2e5b8a3f6d9c
    fromPort: default
    toPort: default
  - id: 6f1c4a7e-9d2b-4f1c-e5a8-1f6c4a7e9d2b
    from: 3b9f6a2d-5c8e-4d1a-f7c4-2e5b8a3f6d9c
    to: 5d2c7f4a-8b1e-4c6d-a9f2-4a7d2c5f8b1e
    fromPort: default
    toPort: default
  - id: 8c4e7a1d-2f5b-4c8e-a1d4-4e8c7a1d2f5b
    from: 5d2c7f4a-8b1e-4c6d-a9f2-4a7d2c5f8b1e
    to: 7f5a8c3b-1d4e-4a9f-c2b7-6e3a7f5c8b1d
    fromPort: success
    toPort: default
  - id: 1a5e8c2d-6f9b-4a1e-c7d2-5a1e8c2d6f9b
    from: 5d2c7f4a-8b1e-4c6d-a9f2-4a7d2c5f8b1e
    to: 3c6f9a1e-8d4b-4f3c-a7e2-6f3c9a1e8d4b
    fromPort: failed
    toPort: default
  - id: 3d8b5a2f-7c4e-4d8b-a6f1-8b3d5a2f7c4e
    from: 7f5a8c3b-1d4e-4a9f-c2b7-6e3a7f5c8b1d
    to: 9c1e4a7b-6f2d-4e5c-a8b1-3f6c9e1a4b7d
    fromPort: default
    toPort: default
  - id: 5f2c8a6d-1e4b-4f2c-a9e4-2c5f8a6d1e4b
    from: 9c1e4a7b-6f2d-4e5c-a8b1-3f6c9e1a4b7d
    to: 3c6f9a1e-8d4b-4f3c-a7e2-6f3c9a1e8d4b
    fromPort: open
    toPort: default
  - id: 7a6f3c9b-4e2d-4a7a-c1f6-6f7a3c9b4e2d
    from: 3b9f6a2d-5c8e-4d1a-f7c4-2e5b8a3f6d9c
    to: 2d8a5f3c-4b7e-4c1d-f9a6-8c2d5a8f3b6e
    fromPort: hole
    toPort: default
  - id: 9c4a7f2e-8d1b-4c9a-f3e6-4a9c7f2e8d1b
    from: 2d8a5f3c-4b7e-4c1d-f9a6-8c2d5a8f3b6e
    to: 4a6c9f2d-7e3b-4d8a-c5f2-1a4c7e9f2d5b
    fromPort: outershell
    toPort: default
  - id: 2e7b4a1c-6f9d-4e2b-a8c5-7b2e4a1c6f9d
    from: 2d8a5f3c-4b7e-4c1d-f9a6-8c2d5a8f3b6e
    to: 6f3b1a8e-9c4d-4a7f-e2c9-3b6f1a8e4c7d
    fromPort: hole
    toPort: default
  - id: 4c8f5a3d-1e6b-4c8f-a2d5-8f4c5a3d1e6b
    from: 4a6c9f2d-7e3b-4d8a-c5f2-1a4c7e9f2d5b
    to: 8e7c4a1f-2d5b-4f8e-a6c3-7f4e1c8a5b2d
    fromPort: default
    toPort: default
  - id: 6a1d7c4f-9e2b-4a1d-c8f5-1a6d7c4f9e2b
    from: 6f3b1a8e-9c4d-4a7f-e2c9-3b6f1a8e4c7d
    to: 1c4f7a2e-5b8d-4a3c-f9e6-4c1f8a7e2b5d
    fromPort: default
    toPort: default
  - id: 8f4c1a6e-3d7b-4f8c-a5e2-4c8f1a6e3d7b
    from: 1c4f7a2e-5b8d-4a3c-f9e6-4c1f8a7e2b5d
    to: 3f5a8c1d-7e4b-4c9f-a2e7-6f3a8c1d4e7b
    fromPort: default
    toPort: default
  - id: 1d7a4c2f-8e5b-4d1a-c6f9-7a1d4c2f8e5b
    from: 8e7c4a1f-2d5b-4f8e-a6c3-7f4e1c8a5b2d
    to: 5b8d1f4a-9c6e-4f2b-c8d5-1f4b8d5a9c2e
    fromPort: default
    toPort: requestor
  - id: 3b6f9a4d-2c8e-4b3b-a7f2-6f3b9a4d2c8e
    from: 3f5a8c1d-7e4b-4c9f-a2e7-6f3a8c1d4e7b
    to: 5b8d1f4a-9c6e-4f2b-c8d5-1f4b8d5a9c2e
    fromPort: default
    toPort: supplier
  - id: 5e2c8f1a-4d7b-4e5e-c9a6-2c5e8f1a4d7b
    from: 5b8d1f4a-9c6e-4f2b-c8d5-1f4b8d5a9c2e
    to: 7d4e9a2c-1f5b-4d8a-e7c4-9a2d7e4c1f5b
    fromPort: merged
    toPort: default
  - id: 7a9d2c5f-6e8b-4a7a-f1d4-9d7a2c5f6e8b
    from: 3f5a8c1d-7e4b-4c9f-a2e7-6f3a8c1d4e7b
    to: 7d4e9a2c-1f5b-4d8a-e7c4-9a2d7e4c1f5b
    fromPort: default
    toPort: default
  - id: 9c6a5f2d-8e1b-4c9c-a4f7-6a9c5f2d8e1b
    from: 7d4e9a2c-1f5b-4d8a-e7c4-9a2d7e4c1f5b
    to: 3c6f9a1e-8d4b-4f3c-a7e2-6f3c9a1e8d4b
    fromPort: point
    toPort: default
  - id: 2f8a5c1d-7e4b-4f2f-a6c9-8a2f5c1d7e4b
    from: 6f3b1a8e-9c4d-4a7f-e2c9-3b6f1a8e4c7d
    to: 9a6c3f8b-4e1d-4a7c-f5b9-3f8a6c9b4e1d
    fromPort: default
    toPort: default
  - id: 4d1c7a5e-9f2b-4d4d-c8a3-1c4d7a5e9f2b
    from: 9a6c3f8b-4e1d-4a7c-f5b9-3f8a6c9b4e1d
    to: 2c7f4a9e-8b1d-4f6c-a3e8-7f2c4a9e1b8d
    fromPort: default
    toPort: default
  - id: 6e5b8a2f-1c4d-4e6e-b9f4-5b6e8a2f1c4d
    from: 2c7f4a9e-8b1d-4f6c-a3e8-7f2c4a9e1b8d
    to: 4e1b7c5a-6f9d-4c2e-b8a5-1c4e7b5a6f9d
    fromPort: area
    toPort: default
  - id: 8a3f6c9d-4e7b-4a8a-f2c5-3f8a6c9d4e7b
    from: 4e1b7c5a-6f9d-4c2e-b8a5-1c4e7b5a6f9d
    to: 5a3b7e9c-2f4d-4a6e-b8c1-3e7a5b9c2f4d
    fromPort: intersectionInterior
    toPort: default
  - id: 9b4c8e2a-6f7d-4b9c-e1a4-2e8b4c9a6f7d
    from: 5a3b7e9c-2f4d-4a6e-b8c1-3e7a5b9c2f4d
    to: 3c6f9a1e-8d4b-4f3c-a7e2-6f3c9a1e8d4b
    fromPort: default
    toPort: default
  - id: 1c7d4a2e-9f5b-4c1c-d8e3-7d1c4a2e9f5b
    from: 6f3b1a8e-9c4d-4a7f-e2c9-3b6f1a8e4c7d
    to: 6b5d8a3f-1c4e-4b7d-a9c2-5d6b8a3f1c4e
    fromPort: default
    toPort: default
  - id: 3e6a9c2f-8d1b-4e3e-a7c4-6a3e9c2f8d1b
    from: 6b5d8a3f-1c4e-4b7d-a9c2-5d6b8a3f1c4e
    to: 8f2a5c7d-3e6b-4a9f-c1d4-2a8f5c7d3e6b
    fromPort: default
    toPort: requestor
  - id: 5b4f7c1a-2e9d-4b5b-c6a9-4f5b7c1a2e9d
    from: 4a6c9f2d-7e3b-4d8a-c5f2-1a4c7e9f2d5b
    to: 8f2a5c7d-3e6b-4a9f-c1d4-2a8f5c7d3e6b
    fromPort: default
    toPort: supplier
  - id: 7d9c2a5f-6e8b-4d7d-c1f6-9c7d2a5f6e8b
    from: 8f2a5c7d-3e6b-4a9f-c1d4-2a8f5c7d3e6b
    to: 1a4d7c2f-9e5b-4d8a-f6c3-4d1a7c2f9e5b
    fromPort: merged
    toPort: default
  - id: 9f2e5c8a-1d4b-4f9f-e4c7-2e9f5c8a1d4b
    from: 1a4d7c2f-9e5b-4d8a-f6c3-4d1a7c2f9e5b
    to: 4b8e2a7d-3f6c-4a1e-b9d5-7a4b8e2d3f6c
    fromPort: incorrectInterior
    toPort: default
  - id: 7c3f1a6e-9d2b-4c8f-a5e1-3f7c1a6e9d2b
    from: 4b8e2a7d-3f6c-4a1e-b9d5-7a4b8e2d3f6c
    to: 3c6f9a1e-8d4b-4f3c-a7e2-6f3c9a1e8d4b
    fromPort: default
    toPort: default
  - id: 2a5c8f1d-7e4b-4f2a-c9e6-5c2a8f1d7e4b
    from: 4f8b3e6a-7d1c-4e5a-c2f9-3a6f9b4e7c1d
    to: 3c6f9a1e-8d4b-4f3c-a7e2-6f3c9a1e8d4b
    fromPort: failed
    toPort: default
- id: 5ebbb775-f99a-45b3-9aa2-3a0c7e909d90
  name: entry_point
  nodes:
  - id: bc9b77cd-ad61-4ccb-b2eb-4e9536f07873
    name: FeatureCreator
    type: action
    action: FeatureCreator
    with:
      creator: |
        [
          #{
            cityGmlPath: env.get("cityGmlPath"),
            cityCode: env.get("cityCode") ?? file::extract_filename(env.get("cityGmlPath"))[0..5],
            baseCityCode: env.get("cityCode") ?? file::extract_filename(env.get("cityGmlPath"))[0..5],
            schemas: env.get("schemas"),
            codelists: env.get("codelists"),
          },
        ]
  - id: a018fcb3-0f1d-4ba1-b96c-242fb8f002a4
    name: DirectoryDecompressor
    type: action
    action: DirectoryDecompressor
    with:
      archiveAttributes:
      - codelists
      - schemas
  - id: e275d299-2cd1-4e26-9d91-4d63921a29c7
    name: FeatureFilePathExtractor
    type: action
    action: FeatureFilePathExtractor
    with:
      destPrefix: udx
      sourceDataset: |
        env.get("__value")["cityGmlPath"]
      extractArchive: true
  - id: 151fa081-4606-4493-8808-35d75f063159
    name: FeatureFilterByGml
    type: action
    action: FeatureFilter
    with:
      conditions:
      - expr: |
          env.get("__value").extension == "gml"
        outputPort: default
  - id: 55c98a8e-b785-4e42-8217-b26610aa243f
    name: FeatureCounterFileIndex
    type: action
    action: FeatureCounter
    with:
      countStart: 1
      outputAttribute: fileIndex
  - id: 55767a5d-6d94-471b-af4a-09e20ae5f024
    name: PLATEAU4.UDXFolderExtractor
    type: action
    action: PLATEAU4.UDXFolderExtractor
    with:
      cityGmlPath: |
        env.get("__value")["path"]
      codelistsPath: codelists
      schemasPath: schemas
  - id: 80f7b3d8-201b-4985-b512-c4b94690c16d
    name: FeatureCityGmlReader
    type: action
    action: FeatureCityGmlReader
    with:
      format: citygml
      flatten: true
      dataset: |
        env.get("__value")["path"]
  - id: 89d41d5e-1a17-4d00-bc1d-8150eb6f79ec
    name: FilterNotCityModel
    type: action
    action: FeatureFilter
    with:
      conditions:
      - expr: |
          env.get("__value").featureType != "CityModel"
        outputPort: default
  - id: 52f504c2-5c79-421c-b14d-8ac661b3b15f
    name: PLATEAU3.LodSplitterWithDM
    type: subGraph
    subGraphId: 7e98d856-1438-4148-bdcb-91747ef2e405
  - id: 8cb3a0a3-4527-466a-a362-6fedddf6a15f
    name: FeatureSorter
    type: action
    action: FeatureSorter
    with:
      attributes:
      - featureType
      order: ascending
  - id: e6a9d5f8-943f-4783-aabd-754dcc6b307d
    name: InstanceCounter
    type: action
    action: StatisticsCalculator
    with:
      groupBy:
      - fileIndex
      - featureType
      - gmlName
      - name
      - udxDirs
      calculations:
      - newAttribute: _num_instances
        expr: '1'
  - id: 22641726-fc4a-4d8a-a375-91b5ac6aac28
    name: AttributeMapperForInstanceCount
    type: action
    action: AttributeMapper
    with:
      mappers:
      - attribute: Folder
        expr: |
          env.get("__value")["udxDirs"] ?? ""
      - attribute: Filename
        expr: |
          env.get("__value")["name"] ?? ""
      - attribute: フィーチャータイプ
        expr: |
          env.get("__value")["featureType"] ?? ""
      - attribute: インスタンス数
        expr: |
          env.get("__value")["_num_instances"] ?? 0
      - attribute: Index
        expr: |
          env.get("__value")["fileIndex"] ?? ""
  - id: a453192e-603c-417e-9f65-f57b8e15f7d3
    name: CsvWriterInstanceCount
    type: action
    action: FeatureWriter
    with:
      format: csv
      output: |
        file::join_path(env.get("outputPath"), "05_土地利用_都市決定情報_区域_地物インスタンス数.csv")
  - id: 7ccbb722-d0cc-4843-a42e-179576530340
    name: FileInfoExtractor
    type: action
    action: AttributeMapper
    with:
      mappers:
      - attribute: Index
        expr: |
          env.get("__value").fileIndex
      - attribute: Filename
        expr: |
          env.get("__value").name
  - id: 2b79c18c-2d61-4d6f-83fb-d766451dbf44
    name: PLATEAU3.SurfaceValidator2D
    type: subGraph
    subGraphId: 8a5b1c9d-2e4f-4a3b-9c5d-1e6f8a2b4c7d
  - id: 3f92e6bb-e63d-4b4e-b4e4-3c0caa55f7c4
    name: AttributeMapperForSurfaceOrientationErrors
    type: action
    action: AttributeMapper
    with:
      mappers:
      - attribute: Folder
        expr: |
          env.get("__value")["udxDirs"] ?? ""
      - attribute: Index
        expr: |
          env.get("__value")["fileIndex"] ?? ""
      - attribute: Filename
        expr: |
          env.get("__value")["name"] ?? ""
      - attribute: FeatureType
        expr: |
          env.get("__value")["featureType"] ?? ""
      - attribute: エラー数
        expr: |
          1
      - attribute: gml:id
        expr: |
          env.get("__value")["featureId"] ?? ""
      - attribute: 面の向き
        expr: "\"right_hand_rule\" \n"
  - id: f0fc0309-6d76-4a6b-9fdf-84c433b615f2
    name: CsvWriterSurfaceOrientationErrors
    type: action
    action: FeatureWriter
    with:
      format: csv
      output: |
        file::join_path(env.get("outputPath"), "05_土地利用_都市決定情報_区域_面の向き不正.csv")
  - id: 26751290-4ac7-4884-908a-7c231b5f820a
    name: SurfaceOrientationErrorCounter
    type: action
    action: StatisticsCalculator
    with:
      groupBy:
      - name
      calculations:
      - newAttribute: _num_incorrect_orientation
        expr: '1'
  - id: ba747af8-c4fb-4481-9406-e14f1d4c7f57
    name: AttributeMapperForSurfaceErrors
    type: action
    action: AttributeMapper
    with:
      mappers:
      - attribute: Folder
        expr: |
          env.get("__value")["udxDirs"] ?? ""
      - attribute: Index
        expr: |
          env.get("__value")["fileIndex"] ?? ""
      - attribute: Filename
        expr: |
          env.get("__value")["name"] ?? ""
      - attribute: FeatureType
        expr: |
          env.get("__value")["featureType"] ?? ""
      - attribute: エラー数
        expr: |
          1
      - attribute: gml:id
        expr: |
          env.get("__value")["featureId"] ?? ""
      - attribute: エラー内容
        expr: |
          env.get("__value")["issue"] ?? ""
  - id: eb34119b-592f-4140-b9b9-f3712a805c47
    name: CsvWriterSurfaceErrors
    type: action
    action: FeatureWriter
    with:
      format: csv
      output: |
        file::join_path(env.get("outputPath"), "05_土地利用_都市決定情報_区域_面のエラー.csv")
  - id: 667c37eb-2b19-4a86-8aa4-70679f7787b5
    name: SurfaceErrorCounter
    type: action
    action: StatisticsCalculator
    with:
      groupBy:
      - name
      calculations:
      - newAttribute: _num_surface_issues
        expr: '1'
  - id: 92119eb6-9343-49b7-b6c2-e2142374c52c
    name: ErrorSummaryMerger
    type: action
    action: FeatureMerger
    with:
      requestorAttributeValue: |
        env.get("__value").Filename
      supplierAttributeValue: |
        env.get("__value").name
  - id: f58eeb2c-9187-4880-8c1f-7da2f9388069
    name: SummaryAttributeMapper
    type: action
    action: AttributeMapper
    with:
      mappers:
      - attribute: Index
        expr: |
          env.get("__value").Index
      - attribute: Filename
        expr: |
          env.get("__value").Filename
      - attribute: 面の向き不正
        expr: |
          env.get("__value")._num_incorrect_orientation ?? 0
      - attribute: 面のエラー
        expr: |
          env.get("__value")._num_surface_issues ?? 0
  - id: f38c754b-98cd-48e1-bfa7-adbf7c390899
    name: CSVSummaryWriter
    type: action
    action: FeatureWriter
    with:
      format: csv
      output: |
        file::join_path(env.get("workerArtifactPath") ?? env.get("outputPath"), "05_土地利用_都市決定情報_区域_検査結果一覧.csv")
  - id: 521b2dea-51af-460f-9eb5-672917768692
    name: StatisticsCalculator
    type: action
    action: StatisticsCalculator
    with:
      calculations:
      - newAttribute: 面の向き不正
        expr: |
          env.get("__value")["面の向き不正"] ?? 0
      - newAttribute: 面のエラー
        expr: |
          env.get("__value")["面のエラー"] ?? 0
      - newAttribute: totalErrorCount
        expr: |
          let total = 0;
          let keys = ["面の向き不正","面のエラー"];
          for key in keys {
            total += env.get("__value")[key] ?? 0;
          }
          total
  - id: 4ed9ffc0-9509-4037-bcb6-117829aab7d5
    name: JSONSummaryWriter
    type: action
    action: FeatureWriter
    with:
      format: json
      converter: |
        if env.get("__features").is_empty() {
          []
        } else {
          let result = [];
          let feature = env.get("__features")[0];
          for key in feature.keys() {
            result.push(#{
              name: key,
              count: feature[key],
            });
          }
          result
        }
      output: |
        file::join_path(env.get("workerArtifactPath") ?? env.get("outputPath"), "summary_luse_urf_area.json")
  - id: 27350bec-6220-4d6e-8fd1-1bd5d01716d3
    name: StatisticsCalculatorTotalErrors
    type: action
    action: StatisticsCalculator
    with:
      calculations:
      - newAttribute: totalErrorCount
        expr: |
          env.get("__value")["totalErrorCount"] ?? 0
  - id: 020bac31-10f6-4a00-8426-630d03970c0f
    name: FeatureFilterNoErrors
    type: action
    action: FeatureFilter
    with:
      conditions:
      - expr: |
          env.get("__value")["totalErrorCount"] == 0
        outputPort: default
  - id: 734ebb2a-c2b0-429e-9363-5ccdd2a5b2ae
    name: JsonWriterQcResultOk
    type: action
    action: JsonWriter
    with:
      converter: '[]'
      output: |
        let filename = file::extract_filename_without_ext(env.get("cityGmlPath")) + "_qc_result_ok";
        let dirname = env.get("workerArtifactPath") ?? env.get("outputPath");
        file::join_path(dirname, filename)
  - id: be482ba8-ca60-40fb-8e52-8b15460b17cc
    name: ZipFileWriter
    type: action
    action: ZipFileWriter
    with:
      output: |
        let filename = file::extract_filename_without_ext(env.get("cityGmlPath")) + "_qc_result.zip";
        let dirname = env.get("workerArtifactPath") ?? env.get("outputPath");
        file::join_path(dirname, filename)
  edges:
  - id: 235074db-bbc0-484e-bd7e-3af7d707f2fc
    from: bc9b77cd-ad61-4ccb-b2eb-4e9536f07873
    to: a018fcb3-0f1d-4ba1-b96c-242fb8f002a4
    fromPort: default
    toPort: default
  - id: e24c990c-4c60-461c-9ac3-a8b05f01af86
    from: a018fcb3-0f1d-4ba1-b96c-242fb8f002a4
    to: e275d299-2cd1-4e26-9d91-4d63921a29c7
    fromPort: default
    toPort: default
  - id: c9d3e589-4e51-47ff-86dc-0e915b368072
    from: e275d299-2cd1-4e26-9d91-4d63921a29c7
    to: 151fa081-4606-4493-8808-35d75f063159
    fromPort: default
    toPort: default
  - id: 2fc1b488-3688-4cfd-8b65-d4d6d327c38f
    from: 151fa081-4606-4493-8808-35d75f063159
    to: 55c98a8e-b785-4e42-8217-b26610aa243f
    fromPort: default
    toPort: default
  - id: f5dcdbfa-3bac-414f-8829-dd1af4f981e7
    from: 55c98a8e-b785-4e42-8217-b26610aa243f
    to: 55767a5d-6d94-471b-af4a-09e20ae5f024
    fromPort: default
    toPort: default
  - id: 17912650-d822-45a9-b31a-81d9bd9932ee
    from: 55767a5d-6d94-471b-af4a-09e20ae5f024
    to: 80f7b3d8-201b-4985-b512-c4b94690c16d
    fromPort: default
    toPort: default
  - id: 4f90c136-9ee8-44ce-b0f5-a70e1c8dc38a
    from: 80f7b3d8-201b-4985-b512-c4b94690c16d
    to: 89d41d5e-1a17-4d00-bc1d-8150eb6f79ec
    fromPort: default
    toPort: default
  - id: bc1dd787-c39b-4fec-8fbc-a7f9911088f3
    from: 89d41d5e-1a17-4d00-bc1d-8150eb6f79ec
    to: 52f504c2-5c79-421c-b14d-8ac661b3b15f
    fromPort: default
    toPort: default
  - id: cf5deb77-5b1a-4a03-88fe-cd3ae2785f7e
    from: 52f504c2-5c79-421c-b14d-8ac661b3b15f
    to: 8cb3a0a3-4527-466a-a362-6fedddf6a15f
    fromPort: lod1
    toPort: default
  - id: b749f31f-3fb8-4c95-b6ea-fb80e6f1b28e
    from: 8cb3a0a3-4527-466a-a362-6fedddf6a15f
    to: e6a9d5f8-943f-4783-aabd-754dcc6b307d
    fromPort: default
    toPort: default
  - id: 1b7e97f5-05b9-4d13-92e7-86d03a7e0975
    from: e6a9d5f8-943f-4783-aabd-754dcc6b307d
    to: 22641726-fc4a-4d8a-a375-91b5ac6aac28
    fromPort: default
    toPort: default
  - id: 9af0a9d4-30b8-4ef8-942e-cbcaac65562a
    from: 22641726-fc4a-4d8a-a375-91b5ac6aac28
    to: a453192e-603c-417e-9f65-f57b8e15f7d3
    fromPort: default
    toPort: default
  - id: 35446d3a-13bd-488c-a15e-24a185fa64bc
    from: 52f504c2-5c79-421c-b14d-8ac661b3b15f
    to: 2b79c18c-2d61-4d6f-83fb-d766451dbf44
    fromPort: lod1
    toPort: default
  - id: 3bc60cc8-2b85-4912-9c9a-be697af8c98e
    from: 2b79c18c-2d61-4d6f-83fb-d766451dbf44
    to: 3f92e6bb-e63d-4b4e-b4e4-3c0caa55f7c4
    fromPort: inCorrectOrientation
    toPort: default
  - id: fb63cbbf-f2c2-4be4-9d2d-5fbf1949d41c
    from: 3f92e6bb-e63d-4b4e-b4e4-3c0caa55f7c4
    to: f0fc0309-6d76-4a6b-9fdf-84c433b615f2
    fromPort: default
    toPort: default
  - id: 0b9b516b-cd3c-466c-8bbe-494dafff2e64
    from: 2b79c18c-2d61-4d6f-83fb-d766451dbf44
    to: ba747af8-c4fb-4481-9406-e14f1d4c7f57
    fromPort: invalidSurface
    toPort: default
  - id: 03533a65-b64e-41a9-a8d7-8df66866f57b
    from: ba747af8-c4fb-4481-9406-e14f1d4c7f57
    to: eb34119b-592f-4140-b9b9-f3712a805c47
    fromPort: default
    toPort: default
  - id: df71e174-5ad7-40e1-9bc2-989014b0880f
    from: 2b79c18c-2d61-4d6f-83fb-d766451dbf44
    to: 26751290-4ac7-4884-908a-7c231b5f820a
    fromPort: inCorrectOrientation
    toPort: default
  - id: fde37f13-ef96-4ab7-907b-140a4f0ef1b5
    from: 2b79c18c-2d61-4d6f-83fb-d766451dbf44
    to: 667c37eb-2b19-4a86-8aa4-70679f7787b5
    fromPort: invalidSurface
    toPort: default
  - id: 4ff8a685-06c9-4227-b33e-0dc21b07fc12
    from: 55767a5d-6d94-471b-af4a-09e20ae5f024
    to: 7ccbb722-d0cc-4843-a42e-179576530340
    fromPort: default
    toPort: default
  - id: 803d0888-212c-4219-93e2-be0b1a9918f0
    from: 7ccbb722-d0cc-4843-a42e-179576530340
    to: 92119eb6-9343-49b7-b6c2-e2142374c52c
    fromPort: default
    toPort: requestor
  - id: 0780d4c5-8446-47ee-8609-d880677f49e0
    from: 26751290-4ac7-4884-908a-7c231b5f820a
    to: 92119eb6-9343-49b7-b6c2-e2142374c52c
    fromPort: default
    toPort: supplier
  - id: dc7a2185-04b0-4e59-8e9a-7731a28fd50a
    from: 667c37eb-2b19-4a86-8aa4-70679f7787b5
    to: 92119eb6-9343-49b7-b6c2-e2142374c52c
    fromPort: default
    toPort: supplier
  - id: cd72aac5-c44c-4195-a881-6dd12406b360
    from: 92119eb6-9343-49b7-b6c2-e2142374c52c
    to: f58eeb2c-9187-4880-8c1f-7da2f9388069
    fromPort: merged
    toPort: default
  - id: ca661de4-3521-4920-ba92-6154c822d64a
    from: 92119eb6-9343-49b7-b6c2-e2142374c52c
    to: f58eeb2c-9187-4880-8c1f-7da2f9388069
    fromPort: unmerged
    toPort: default
  - id: e579e69e-6f24-47be-8bb2-642d48d9fe6d
    from: f58eeb2c-9187-4880-8c1f-7da2f9388069
    to: f38c754b-98cd-48e1-bfa7-adbf7c390899
    fromPort: default
    toPort: default
  - id: c5d7057d-b240-4493-9141-6b26faaf03ba
    from: f58eeb2c-9187-4880-8c1f-7da2f9388069
    to: 521b2dea-51af-460f-9eb5-672917768692
    fromPort: default
    toPort: default
  - id: b51cd2a6-7885-4b2f-9234-2dd759fe47dc
    from: 521b2dea-51af-460f-9eb5-672917768692
    to: 4ed9ffc0-9509-4037-bcb6-117829aab7d5
    fromPort: default
    toPort: default
  - id: 16f040ee-6f4b-4c66-bdd8-cd03dcc4fb9a
    from: 521b2dea-51af-460f-9eb5-672917768692
    to: 27350bec-6220-4d6e-8fd1-1bd5d01716d3
    fromPort: default
    toPort: default
  - id: 3054b3f1-24b0-45d8-a3e7-7938409c900d
    from: 27350bec-6220-4d6e-8fd1-1bd5d01716d3
    to: 020bac31-10f6-4a00-8426-630d03970c0f
    fromPort: default
    toPort: default
  - id: 83f795ad-d183-4bbd-b7a5-e9da5497fe16
    from: 020bac31-10f6-4a00-8426-630d03970c0f
    to: 734ebb2a-c2b0-429e-9363-5ccdd2a5b2ae
    fromPort: default
    toPort: default
  - id: b4a13b04-9c9c-4152-a221-7c74947b59b3
    from: f38c754b-98cd-48e1-bfa7-adbf7c390899
    to: be482ba8-ca60-40fb-8e52-8b15460b17cc
    fromPort: default
    toPort: default
  - id: ed977dcd-0d9d-4b25-9e84-7293c16a23fb
    from: a453192e-603c-417e-9f65-f57b8e15f7d3
    to: be482ba8-ca60-40fb-8e52-8b15460b17cc
    fromPort: default
    toPort: default
  - id: 5acd4c49-d2ec-45fa-a23a-78eee8fca01c
    from: 4ed9ffc0-9509-4037-bcb6-117829aab7d5
    to: be482ba8-ca60-40fb-8e52-8b15460b17cc
    fromPort: default
    toPort: default
  - id: 3556fbd8-fce4-490a-a455-2503ca11e5ae
    from: f0fc0309-6d76-4a6b-9fdf-84c433b615f2
    to: be482ba8-ca60-40fb-8e52-8b15460b17cc
    fromPort: default
    toPort: default
  - id: 5c237b4e-c960-4a87-a7a2-e9633aa5e093
    from: eb34119b-592f-4140-b9b9-f3712a805c47
    to: be482ba8-ca60-40fb-8e52-8b15460b17cc
    fromPort: default
    toPort: default
