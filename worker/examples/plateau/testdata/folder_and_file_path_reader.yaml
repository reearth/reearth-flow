---
id: 7b66c0a4-e1fa-41dd-a0c9-df3f6e01cc22
name: "PLATEAU.FolderAndFilePathReader"
entryGraphId: c6863b71-953b-4d15-af56-396fc93fc617
with:
  targetPackages:
graphs:
  - id: c6863b71-953b-4d15-af56-396fc93fc617
    name: entrypoint
    nodes:
      - id: b1a91180-ab88-4c1a-aab5-48c242a218ca
        name: FilePathExtractor01
        type: action
        action: FilePathExtractor
        with:
          sourceDataset: "https://assets.cms.plateau.reearth.io/assets/18/1ebcee-4f38-47c7-90b1-224a8a117bcd/13229_nishitokyo-shi_2022_citygml_1_op.zip"
          extractArchive: true

      - id: b1a91180-ab88-4c1a-aab5-48c242a218cb
        name: EntityFilter01
        type: action
        action: EntityFilter
        with:
          conditions:
            - expr: |
                env.get("extension") == "gml"
              outputPort: default

      - id: b1a91180-ab88-4c1a-aab5-48c242a218cc
        name: PLATEAU.UDXFolderExtractor-01
        type: action
        action: PLATEAU.UDXFolderExtractor
        with:
          cityGmlPath: |
            env.get("path")

      - id: b1a91180-ab88-4c1a-aab5-48c242a218cd
        name: EntityFilter02
        type: action
        action: EntityFilter
        with:
          conditions:
            - expr: |
                (env.get("targetPackages") ?? []).is_empty() || env.get("package") in env.get("targetPackages")
              outputPort: default

      - id: b1a91180-ab88-4c1a-aab5-48c242a218ce
        name: EntityCounter01
        type: action
        action: EntityCounter
        with:
          countStart: 1
          groupBy:
            - udxDirs
          outputAttribute: fileIndex

    edges:
      - id: 1379a497-9e4e-40fb-8361-d2eeeb491762
        from: b1a91180-ab88-4c1a-aab5-48c242a218ca
        to: b1a91180-ab88-4c1a-aab5-48c242a218cb
        fromPort: default
        toPort: default
      - id: 2379a497-9e4e-40fb-8361-d2eeeb491763
        from: b1a91180-ab88-4c1a-aab5-48c242a218cb
        to: b1a91180-ab88-4c1a-aab5-48c242a218cc
        fromPort: default
        toPort: default
      - id: 2379a497-9e4e-40fb-8361-d2eeeb491764
        from: b1a91180-ab88-4c1a-aab5-48c242a218cc
        to: b1a91180-ab88-4c1a-aab5-48c242a218cd
        fromPort: default
        toPort: default
      - id: 2379a497-9e4e-40fb-8361-d2eeeb491766
        from: b1a91180-ab88-4c1a-aab5-48c242a218cd
        to: b1a91180-ab88-4c1a-aab5-48c242a218ce
        fromPort: default
        toPort: default
